<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>

let atomStr = "(OB40Li30CHe3O48LiNN26)33C12Li48N30H13HBe31";

while (atomStr.indexOf('(') > -1) {
  atomStr = simplifyAtoms(atomStr);
}
atomStr = combineAtoms(atomStr);
console.log(atomStr);

function simplifyAtoms(atomStr) {
  const openIndex = atomStr.lastIndexOf("(");
  const closeIndex = atomStr.indexOf(")");
  let lastIndex;
  let multiplier = 1;
  if (/[\d]/.test(atomStr[closeIndex + 1])) {
    lastIndex = closeIndex + atomStr.substring(closeIndex).match(/\d+/)[0].length;
    multiplier *= Number(atomStr.substring(closeIndex).match(/\d+/)[0]);
  }
  const strArr = atomStr.substring(openIndex + 1, closeIndex).split(/([A-Z][a-z]*)/).slice(1);
  for (let index in strArr) {
    if (!strArr[index].length) {
      strArr[index] = multiplier;
    } else if (Number(strArr[index])) {
      strArr[index] = Number(strArr[index]) * multiplier;
    }
  }
  return atomStr.substring(0, openIndex) + strArr.join('') + atomStr.substring(lastIndex + 1);
}

function combineAtoms(atomStr) {
  let strArr = atomStr.split(/([A-Z][a-z]*)/);
  strArr = strArr.filter(value => value.length);
  let combinedAtoms = {};
  for (let index = 0; index < strArr.length; index++) {
    if (!Number(strArr[index])) {
      if (combinedAtoms[strArr[index]] && Number(strArr[index + 1])) {
        combinedAtoms[strArr[index]] += Number(strArr[index + 1]);
      } else if (combinedAtoms[strArr[index]] && !Number(strArr[index + 1])) {
        combinedAtoms[strArr[index]] += 1;
      } else if (!combinedAtoms[strArr[index]] && Number(strArr[index + 1])) {
        combinedAtoms[strArr[index]] = Number(strArr[index + 1]);
      } else {
        combinedAtoms[strArr[index]] = 1;
      }
    }
  }
  let atomArr = [];
  for (atom in combinedAtoms) {
    atomArr.push([atom, combinedAtoms[atom]]);
  }
  atomArr = atomArr.sort((a, b) => {
    if (a[0] > b [0]) {
      return 1;
    } else {
      return -1;
    }
  });
  atomArr = atomArr.flat().filter(value => value !== 1).join('');
  return atomArr;
}

  </script>
</body>
</html>
